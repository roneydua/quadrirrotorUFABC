<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.9.1" xml:lang="pt-BR">
  <compounddef id="IMU_8cpp" kind="file" language="C++">
    <compoundname>IMU.cpp</compoundname>
    <includes refid="IMU_8h" local="yes">IMU.h</includes>
    <includes local="yes">Arduino.h</includes>
    <incdepgraph>
      <node id="4">
        <label>eigen3/Eigen/Dense</label>
      </node>
      <node id="3">
        <label>METODOSCALIBRACAO.h</label>
        <link refid="METODOSCALIBRACAO_8h"/>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
      </node>
      <node id="1">
        <label>lib/IMU/IMU.cpp</label>
        <link refid="IMU_8cpp"/>
        <childnode refid="2" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
      </node>
      <node id="6">
        <label>Wire.h</label>
      </node>
      <node id="5">
        <label>Arduino.h</label>
      </node>
      <node id="2">
        <label>IMU.h</label>
        <link refid="IMU_8h"/>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
      </node>
    </incdepgraph>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
<para><simplesect kind="author"><para>: roney </para>
</simplesect>
<simplesect kind="date"><para>: 2021-05-03T16:29:30-03:00 email: <ulink url="mailto:roneyddasilva@gmail.com">roneyddasilva@gmail.com</ulink></para>
</simplesect>
Last modified by: roney Last modified time: 2021-07-19T18:32:20-03:00 </para>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="normal"></highlight></codeline>
<codeline lineno="10"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="IMU_8h" kindref="compound">IMU.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="11"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;Arduino.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="17" refid="classIMU_1acad2acbbf58db76230da27dba2afe8de" refkind="member"><highlight class="normal"><ref refid="classIMU_1acad2acbbf58db76230da27dba2afe8de" kindref="member">IMU::IMU</ref>(TwoWire<sp/>&amp;bus,<sp/>uint8_t<sp/>address)<sp/>{</highlight></codeline>
<codeline lineno="18"><highlight class="normal"><sp/><sp/><ref refid="classIMU_1a18fe8e6be1b14c9e6c1b47d884dae375" kindref="member">_i2c</ref><sp/>=<sp/>&amp;bus;</highlight></codeline>
<codeline lineno="19"><highlight class="normal"><sp/><sp/><ref refid="classIMU_1ac538fc9a09f4d60b73fb477738b0d602" kindref="member">_address</ref><sp/>=<sp/>address;</highlight></codeline>
<codeline lineno="20"><highlight class="normal"><sp/><sp/>Serial.println(</highlight><highlight class="stringliteral">&quot;Imu<sp/>ok&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="21"><highlight class="normal">}</highlight></codeline>
<codeline lineno="29" refid="classIMU_1ae0d964d2f8ec122be068c41b84bc18a8" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="classIMU_1ae0d964d2f8ec122be068c41b84bc18a8" kindref="member">IMU::begin</ref>(Vector3f<sp/>&amp;acel,<sp/>Vector3f<sp/>&amp;gyro,<sp/>Vector3f<sp/>&amp;mag)<sp/>{</highlight></codeline>
<codeline lineno="30"><highlight class="normal"><sp/><sp/><ref refid="classIMU_1a0efdfa77f452641689be4e9a4bae6a12" kindref="member">_acel</ref><sp/>=<sp/>&amp;acel;</highlight></codeline>
<codeline lineno="31"><highlight class="normal"><sp/><sp/><ref refid="classIMU_1a72d1d4fe1027a9b0d6eed394e18ea97b" kindref="member">_gyro</ref><sp/>=<sp/>&amp;gyro;</highlight></codeline>
<codeline lineno="32"><highlight class="normal"><sp/><sp/><ref refid="classIMU_1a54e4834bdf8648b7ec11ca460b92facf" kindref="member">_mag</ref><sp/>=<sp/>&amp;mag;</highlight></codeline>
<codeline lineno="33"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>para<sp/>analise<sp/>da<sp/>calibracao</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="34"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>inicializa<sp/>a<sp/>biblioteca<sp/>Wire<sp/>para<sp/>comunicacao<sp/>i2c</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="35"><highlight class="normal"><sp/><sp/><ref refid="classIMU_1a18fe8e6be1b14c9e6c1b47d884dae375" kindref="member">_i2c</ref>-&gt;begin(21,<sp/>22);</highlight></codeline>
<codeline lineno="36"><highlight class="normal"></highlight></codeline>
<codeline lineno="37"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>seta<sp/>a<sp/>frequencia<sp/>de<sp/>comunicacao<sp/>I2c</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="38"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>_i2c-&gt;setClock(_i2cRate);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="39"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>seleciona<sp/>o<sp/>&quot;clock<sp/>source&quot;<sp/>do<sp/>giroscopio</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="40"><highlight class="normal"></highlight></codeline>
<codeline lineno="41"><highlight class="normal"><sp/><sp/><ref refid="classIMU_1a37694424e4502ffc69bbb6c540c1a400" kindref="member">writeRegister</ref>(<ref refid="classIMU_1a66529d6102c44bc6be8d8ef167f27058" kindref="member">PWR_MGMNT_1</ref>,<sp/><ref refid="classIMU_1aed128bfb60251b9016454f9b491b0d3e" kindref="member">CLOCK_SEL_PLL</ref>);</highlight></codeline>
<codeline lineno="42"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>habilita<sp/>o<sp/>modo<sp/>master<sp/>i2c</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="43"><highlight class="normal"><sp/><sp/><ref refid="classIMU_1a37694424e4502ffc69bbb6c540c1a400" kindref="member">writeRegister</ref>(<ref refid="classIMU_1a82f56158c28ca51ed7fe9a667b668080" kindref="member">USER_CTRL</ref>,<sp/><ref refid="classIMU_1aac5f67e0f33068d9ca184e8338cea69b" kindref="member">I2C_MST_EN</ref>);</highlight></codeline>
<codeline lineno="44"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>configura<sp/>a<sp/>frequencia<sp/>do<sp/>I2c</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="45"><highlight class="normal"><sp/><sp/><ref refid="classIMU_1a37694424e4502ffc69bbb6c540c1a400" kindref="member">writeRegister</ref>(<ref refid="classIMU_1a40a6c474b6590faa545bcef6796e0b09" kindref="member">I2C_MST_CTRL</ref>,<sp/><ref refid="classIMU_1a19704607249a2df9ae115cf5ec42b065" kindref="member">I2C_MST_CLK</ref>);</highlight></codeline>
<codeline lineno="46"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>desliga<sp/>o<sp/>magnetometro</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="47"><highlight class="normal"><sp/><sp/><ref refid="classIMU_1af3b90e0b20d4bd55091be99f7aa67737" kindref="member">writeAK8963Register</ref>(<ref refid="classIMU_1aa8691a633c35d2f7d7951f68b187adb3" kindref="member">AK8963_CNTL1</ref>,<sp/><ref refid="classIMU_1aa96e1f69db3a08f6ac0c0115d9e8e880" kindref="member">AK8963_PWR_DOWN</ref>);</highlight></codeline>
<codeline lineno="48"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>reseta<sp/>a<sp/>MPU9250</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="49"><highlight class="normal"><sp/><sp/><ref refid="classIMU_1a37694424e4502ffc69bbb6c540c1a400" kindref="member">writeRegister</ref>(<ref refid="classIMU_1a66529d6102c44bc6be8d8ef167f27058" kindref="member">PWR_MGMNT_1</ref>,<sp/><ref refid="classIMU_1a045e1ec896d0e207d640d1fb7930328f" kindref="member">PWR_RESET</ref>);</highlight></codeline>
<codeline lineno="50"><highlight class="normal"><sp/><sp/>delay(1);</highlight></codeline>
<codeline lineno="51"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>reset<sp/>o<sp/>magnetometro</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="52"><highlight class="normal"><sp/><sp/><ref refid="classIMU_1af3b90e0b20d4bd55091be99f7aa67737" kindref="member">writeAK8963Register</ref>(<ref refid="classIMU_1ab6945cc8ff2e84fa2f0927388d74fec1" kindref="member">AK8963_CNTL2</ref>,<sp/><ref refid="classIMU_1ad170d8561fc4600092a29e1b3ff214a6" kindref="member">AK8963_RESET</ref>);</highlight></codeline>
<codeline lineno="53"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>seleciona<sp/>o<sp/>&quot;clock<sp/>source&quot;<sp/>do<sp/>giroscopio</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="54"><highlight class="normal"><sp/><sp/><ref refid="classIMU_1a37694424e4502ffc69bbb6c540c1a400" kindref="member">writeRegister</ref>(<ref refid="classIMU_1a66529d6102c44bc6be8d8ef167f27058" kindref="member">PWR_MGMNT_1</ref>,<sp/><ref refid="classIMU_1aed128bfb60251b9016454f9b491b0d3e" kindref="member">CLOCK_SEL_PLL</ref>);</highlight></codeline>
<codeline lineno="55"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>habilita<sp/>o<sp/>acelerometro<sp/>o<sp/>giroscopio</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="56"><highlight class="normal"><sp/><sp/><ref refid="classIMU_1a37694424e4502ffc69bbb6c540c1a400" kindref="member">writeRegister</ref>(<ref refid="classIMU_1a8e2a7777d4356a5c4cf6cb52e9aeed4b" kindref="member">PWR_MGMNT_2</ref>,<sp/><ref refid="classIMU_1ad52e1d65ca1b23161ff28ea6a0891a1b" kindref="member">SEN_ENABLE</ref>);</highlight></codeline>
<codeline lineno="57"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>selecionas<sp/>as<sp/>escalas<sp/>de<sp/>16G<sp/>e<sp/>2000DPS<sp/>para<sp/>acel<sp/>e<sp/>Giro<sp/>como<sp/>padrao</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="58"><highlight class="normal"><sp/><sp/><ref refid="classIMU_1a5567bbe0d211f1e6d386eb69ffd960a7" kindref="member">setAccelRange</ref>(<ref refid="classIMU_1acdbd8690acc2a34f12d568cb39486cc6a5398002690dded81a155ebdf7baea27f" kindref="member">ACCEL_RANGE_16G</ref>);</highlight></codeline>
<codeline lineno="59"><highlight class="normal"><sp/><sp/><ref refid="classIMU_1a834f21762003f831e5e632cc7974ba75" kindref="member">setGyroRange</ref>(<ref refid="classIMU_1aeb363437539137b5c1eabd3641d242d1ac11c26d662eb1906caf70fb73d96e8bb" kindref="member">GYRO_RANGE_1000DPS</ref>);</highlight></codeline>
<codeline lineno="60"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>atribui<sp/>define<sp/>a<sp/>largura<sp/>de<sp/>banda<sp/>como<sp/>padrao</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="61"><highlight class="normal"><sp/><sp/><ref refid="classIMU_1a1301777da9bc68eee7dc744a62b06ac3" kindref="member">_bandwidth</ref><sp/>=<sp/><ref refid="classIMU_1a90c4f91f60185430b763f152ecb39521a1d05af591f93fc300ae7ef2608c62f51" kindref="member">DLPF_BANDWIDTH_5HZ</ref>;</highlight></codeline>
<codeline lineno="62"><highlight class="normal"><sp/><sp/><ref refid="classIMU_1a928fa5e2db05bd402a3fa93bd3584527" kindref="member">setDlpfBandwidth</ref>(<ref refid="classIMU_1a1301777da9bc68eee7dc744a62b06ac3" kindref="member">_bandwidth</ref>);</highlight></codeline>
<codeline lineno="63"><highlight class="normal"><sp/><sp/><ref refid="classIMU_1a37694424e4502ffc69bbb6c540c1a400" kindref="member">writeRegister</ref>(<ref refid="classIMU_1a1baa422b103a5b9c2677c8e447b11ebe" kindref="member">SMPDIV</ref>,<sp/>0x00);</highlight></codeline>
<codeline lineno="64"><highlight class="normal"><sp/><sp/><ref refid="classIMU_1a3eb0783394601a5a41fa7079e4c929b0" kindref="member">_srd</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="65"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>enable<sp/>I2C<sp/>master<sp/>mode</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="66"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classIMU_1a37694424e4502ffc69bbb6c540c1a400" kindref="member">writeRegister</ref>(<ref refid="classIMU_1a82f56158c28ca51ed7fe9a667b668080" kindref="member">USER_CTRL</ref>,<sp/><ref refid="classIMU_1aac5f67e0f33068d9ca184e8338cea69b" kindref="member">I2C_MST_EN</ref>)<sp/>&lt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="67"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-12;</highlight></codeline>
<codeline lineno="68"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="69"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>set<sp/>the<sp/>I2C<sp/>bus<sp/>speed<sp/>to<sp/>400<sp/>kHz</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="70"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classIMU_1a37694424e4502ffc69bbb6c540c1a400" kindref="member">writeRegister</ref>(<ref refid="classIMU_1a40a6c474b6590faa545bcef6796e0b09" kindref="member">I2C_MST_CTRL</ref>,<sp/><ref refid="classIMU_1a19704607249a2df9ae115cf5ec42b065" kindref="member">I2C_MST_CLK</ref>)<sp/>&lt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="71"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-13;</highlight></codeline>
<codeline lineno="72"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="73"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>check<sp/>AK8963<sp/>WHO<sp/>AM<sp/>I<sp/>register,<sp/>expected<sp/>value<sp/>is<sp/>0x48<sp/>(decimal<sp/>72)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="74"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classIMU_1acd2af48f4eb0a0321080332016e3c1f7" kindref="member">whoAmIAK8963</ref>()<sp/>!=<sp/>72)<sp/>{</highlight></codeline>
<codeline lineno="75"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-14;</highlight></codeline>
<codeline lineno="76"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="77"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*<sp/>get<sp/>the<sp/>magnetometer<sp/>calibration<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="78"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>set<sp/>AK8963<sp/>to<sp/>Power<sp/>Down</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="79"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classIMU_1af3b90e0b20d4bd55091be99f7aa67737" kindref="member">writeAK8963Register</ref>(<ref refid="classIMU_1aa8691a633c35d2f7d7951f68b187adb3" kindref="member">AK8963_CNTL1</ref>,<sp/><ref refid="classIMU_1aa96e1f69db3a08f6ac0c0115d9e8e880" kindref="member">AK8963_PWR_DOWN</ref>)<sp/>&lt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="80"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-15;</highlight></codeline>
<codeline lineno="81"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="82"><highlight class="normal"><sp/><sp/>delay(100);<sp/></highlight><highlight class="comment">//<sp/>long<sp/>wait<sp/>between<sp/>AK8963<sp/>mode<sp/>changes</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="83"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>set<sp/>AK8963<sp/>to<sp/>FUSE<sp/>ROM<sp/>access</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="84"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classIMU_1af3b90e0b20d4bd55091be99f7aa67737" kindref="member">writeAK8963Register</ref>(<ref refid="classIMU_1aa8691a633c35d2f7d7951f68b187adb3" kindref="member">AK8963_CNTL1</ref>,<sp/><ref refid="classIMU_1aefe9d58c962b042b5e772342fe510170" kindref="member">AK8963_FUSE_ROM</ref>)<sp/>&lt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="85"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-16;</highlight></codeline>
<codeline lineno="86"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="87"><highlight class="normal"><sp/><sp/>delay(100);</highlight></codeline>
<codeline lineno="88"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>para<sp/>detalhes<sp/>ver<sp/>manual<sp/>AK8963<sp/>pag.<sp/>32<sp/><sp/>e<sp/>pg.<sp/>29</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="89"><highlight class="normal"><sp/><sp/><ref refid="classIMU_1a914f8b4262fba70e6d8fd0e584fa7996" kindref="member">readAK8963Registers</ref>(<ref refid="classIMU_1a5dc26b210ba9adcc176b9e837238d87d" kindref="member">AK8963_ASA</ref>,<sp/>3,<sp/><ref refid="classIMU_1a36ebf3acc2b8f819d6f08650ddd98ca3" kindref="member">_buffer</ref>);</highlight></codeline>
<codeline lineno="90"><highlight class="normal"><sp/><sp/><ref refid="classIMU_1aca68ebe4db6de0261ad0c18ab93baa0c" kindref="member">_magScaleX</ref><sp/>=<sp/>((((float)<ref refid="classIMU_1a36ebf3acc2b8f819d6f08650ddd98ca3" kindref="member">_buffer</ref>[0])<sp/>-<sp/>128.0)<sp/>/<sp/>(256.0)<sp/>+<sp/>1.0)<sp/>*<sp/>4912.0<sp/>/</highlight></codeline>
<codeline lineno="91"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>32760.0;<sp/></highlight><highlight class="comment">//<sp/>micro<sp/>Tesla</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="92"><highlight class="normal"><sp/><sp/><ref refid="classIMU_1a7ec96517f746cb52f51c7df54316c133" kindref="member">_magScaleY</ref><sp/>=<sp/>((((float)<ref refid="classIMU_1a36ebf3acc2b8f819d6f08650ddd98ca3" kindref="member">_buffer</ref>[1])<sp/>-<sp/>128.0)<sp/>/<sp/>(256.0)<sp/>+<sp/>1.0)<sp/>*<sp/>4912.0<sp/>/</highlight></codeline>
<codeline lineno="93"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>32760.0;<sp/></highlight><highlight class="comment">//<sp/>micro<sp/>Tesla</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="94"><highlight class="normal"><sp/><sp/><ref refid="classIMU_1a47b29b6c4ab5bdb220547362363fa988" kindref="member">_magScaleZ</ref><sp/>=<sp/>((((float)<ref refid="classIMU_1a36ebf3acc2b8f819d6f08650ddd98ca3" kindref="member">_buffer</ref>[2])<sp/>-<sp/>128.0)<sp/>/<sp/>(256.0)<sp/>+<sp/>1.0)<sp/>*<sp/>4912.0<sp/>/</highlight></codeline>
<codeline lineno="95"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>32760.0;<sp/></highlight><highlight class="comment">//<sp/>micro<sp/>Tesla</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="96"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>set<sp/>AK8963<sp/>desligao<sp/>magnetometro</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="97"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classIMU_1af3b90e0b20d4bd55091be99f7aa67737" kindref="member">writeAK8963Register</ref>(<ref refid="classIMU_1aa8691a633c35d2f7d7951f68b187adb3" kindref="member">AK8963_CNTL1</ref>,<sp/><ref refid="classIMU_1aa96e1f69db3a08f6ac0c0115d9e8e880" kindref="member">AK8963_PWR_DOWN</ref>)<sp/>&lt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="98"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-17;</highlight></codeline>
<codeline lineno="99"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="100"><highlight class="normal"><sp/><sp/>delay(100);<sp/></highlight><highlight class="comment">//<sp/>delay<sp/>para<sp/>aplicacao<sp/>das<sp/>configuracoes</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="101"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>inicializa<sp/>o<sp/>magnetometro<sp/>com<sp/>resolucao<sp/>de<sp/>16bit<sp/>e<sp/>100Hz</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="102"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classIMU_1af3b90e0b20d4bd55091be99f7aa67737" kindref="member">writeAK8963Register</ref>(<ref refid="classIMU_1aa8691a633c35d2f7d7951f68b187adb3" kindref="member">AK8963_CNTL1</ref>,<sp/><ref refid="classIMU_1a81aa27b2da74539d88966ab71c28337d" kindref="member">AK8963_CNT_MEAS2</ref>)<sp/>&lt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="103"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-18;</highlight></codeline>
<codeline lineno="104"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="105"><highlight class="normal"><sp/><sp/>delay(100);<sp/></highlight><highlight class="comment">//<sp/>delay<sp/>para<sp/>aplicacao<sp/>das<sp/>configuracoes</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="106"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>select<sp/>clock<sp/>source<sp/>to<sp/>gyro</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="107"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classIMU_1a37694424e4502ffc69bbb6c540c1a400" kindref="member">writeRegister</ref>(<ref refid="classIMU_1a66529d6102c44bc6be8d8ef167f27058" kindref="member">PWR_MGMNT_1</ref>,<sp/><ref refid="classIMU_1aed128bfb60251b9016454f9b491b0d3e" kindref="member">CLOCK_SEL_PLL</ref>)<sp/>&lt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="108"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-19;</highlight></codeline>
<codeline lineno="109"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="110"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>instruct<sp/>the<sp/>MPU9250<sp/>to<sp/>get<sp/>7<sp/>bytes<sp/>of<sp/>data<sp/>from<sp/>the<sp/>AK8963<sp/>at<sp/>the<sp/>sample</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="111"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>rate</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="112"><highlight class="normal"><sp/><sp/><ref refid="classIMU_1a914f8b4262fba70e6d8fd0e584fa7996" kindref="member">readAK8963Registers</ref>(<ref refid="classIMU_1af5582b84ecf8829cfc7da6ad1ed3296a" kindref="member">AK8963_HXL</ref>,<sp/>7,<sp/><ref refid="classIMU_1a36ebf3acc2b8f819d6f08650ddd98ca3" kindref="member">_buffer</ref>);</highlight></codeline>
<codeline lineno="113"><highlight class="normal"></highlight></codeline>
<codeline lineno="114"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="115"><highlight class="normal">}</highlight></codeline>
<codeline lineno="121" refid="classIMU_1a5567bbe0d211f1e6d386eb69ffd960a7" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="classIMU_1a5567bbe0d211f1e6d386eb69ffd960a7" kindref="member">IMU::setAccelRange</ref>(<ref refid="classIMU_1acdbd8690acc2a34f12d568cb39486cc6" kindref="member">AccelRange</ref><sp/>range)<sp/>{</highlight></codeline>
<codeline lineno="122"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">switch</highlight><highlight class="normal"><sp/>(range)<sp/>{</highlight></codeline>
<codeline lineno="123"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="classIMU_1acdbd8690acc2a34f12d568cb39486cc6a808bf1fd48b91e042cfde2d0fd570823" kindref="member">ACCEL_RANGE_2G</ref>:<sp/>{</highlight></codeline>
<codeline lineno="124"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>setting<sp/>the<sp/>accel<sp/>range<sp/>to<sp/>2G</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="125"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classIMU_1a37694424e4502ffc69bbb6c540c1a400" kindref="member">writeRegister</ref>(<ref refid="classIMU_1a71dae5b97d1b74436843e3e822ff4a32" kindref="member">ACCEL_CONFIG</ref>,<sp/><ref refid="classIMU_1ac90c7b0bb203e2dff90306482614433e" kindref="member">ACCEL_FS_SEL_2G</ref>)<sp/>&lt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="126"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="127"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="128"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classIMU_1a28eb12db9c58ca68e4ddb5020dd9dd20" kindref="member">_accelScale</ref><sp/>=<sp/>(<ref refid="classIMU_1ac33cd97144f35683cfda7776ea16243e" kindref="member">gG</ref><sp/>*<sp/>2.0)<sp/>/<sp/>32768.0;<sp/></highlight><highlight class="comment">//<sp/>setting<sp/>the<sp/>accel<sp/>scale<sp/>to<sp/>2G</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="129"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="130"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="131"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="classIMU_1acdbd8690acc2a34f12d568cb39486cc6a4afca3881c874d1d4e0d28a21bfe926a" kindref="member">ACCEL_RANGE_4G</ref>:<sp/>{</highlight></codeline>
<codeline lineno="132"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>setting<sp/>the<sp/>accel<sp/>range<sp/>to<sp/>4G</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="133"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classIMU_1a37694424e4502ffc69bbb6c540c1a400" kindref="member">writeRegister</ref>(<ref refid="classIMU_1a71dae5b97d1b74436843e3e822ff4a32" kindref="member">ACCEL_CONFIG</ref>,<sp/><ref refid="classIMU_1a6d4e8157bb4c0dc204b66c9bbf7c6cb0" kindref="member">ACCEL_FS_SEL_4G</ref>)<sp/>&lt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="134"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="135"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="136"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classIMU_1a28eb12db9c58ca68e4ddb5020dd9dd20" kindref="member">_accelScale</ref><sp/>=<sp/>(<ref refid="classIMU_1ac33cd97144f35683cfda7776ea16243e" kindref="member">gG</ref><sp/>*<sp/>4.0f)<sp/>/<sp/>32768.0f;<sp/></highlight><highlight class="comment">//<sp/>setting<sp/>the<sp/>accel<sp/>scale<sp/>to<sp/>4G</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="137"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="138"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="139"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="classIMU_1acdbd8690acc2a34f12d568cb39486cc6a19c2caa0c23242f9dfd88326f2922719" kindref="member">ACCEL_RANGE_8G</ref>:<sp/>{</highlight></codeline>
<codeline lineno="140"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>setting<sp/>the<sp/>accel<sp/>range<sp/>to<sp/>8G</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="141"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classIMU_1a37694424e4502ffc69bbb6c540c1a400" kindref="member">writeRegister</ref>(<ref refid="classIMU_1a71dae5b97d1b74436843e3e822ff4a32" kindref="member">ACCEL_CONFIG</ref>,<sp/><ref refid="classIMU_1a62e76f7ca4450fbff9ba169a7bf5d183" kindref="member">ACCEL_FS_SEL_8G</ref>)<sp/>&lt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="142"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="143"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="144"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classIMU_1a28eb12db9c58ca68e4ddb5020dd9dd20" kindref="member">_accelScale</ref><sp/>=<sp/>(<ref refid="classIMU_1ac33cd97144f35683cfda7776ea16243e" kindref="member">gG</ref><sp/>*<sp/>8.0f)<sp/>/<sp/>32768.0f;<sp/></highlight><highlight class="comment">//<sp/>setting<sp/>the<sp/>accel<sp/>scale<sp/>to<sp/>8G</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="145"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="146"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="147"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="classIMU_1acdbd8690acc2a34f12d568cb39486cc6a5398002690dded81a155ebdf7baea27f" kindref="member">ACCEL_RANGE_16G</ref>:<sp/>{</highlight></codeline>
<codeline lineno="148"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>setting<sp/>the<sp/>accel<sp/>range<sp/>to<sp/>16G</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="149"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classIMU_1a37694424e4502ffc69bbb6c540c1a400" kindref="member">writeRegister</ref>(<ref refid="classIMU_1a71dae5b97d1b74436843e3e822ff4a32" kindref="member">ACCEL_CONFIG</ref>,<sp/><ref refid="classIMU_1a920aa5f13b9c8e5bc927927330ac8af2" kindref="member">ACCEL_FS_SEL_16G</ref>)<sp/>&lt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="150"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="151"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="152"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classIMU_1a28eb12db9c58ca68e4ddb5020dd9dd20" kindref="member">_accelScale</ref><sp/>=<sp/>(<ref refid="classIMU_1ac33cd97144f35683cfda7776ea16243e" kindref="member">gG</ref><sp/>*<sp/>16.0f)<sp/>/<sp/>32768.0f;<sp/></highlight><highlight class="comment">//<sp/>setting<sp/>the<sp/>accel<sp/>scale<sp/>to<sp/>16G</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="153"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="154"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="155"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="156"><highlight class="normal"><sp/><sp/><ref refid="classIMU_1a81407c3f7e8e63735dfc672b53fd99dd" kindref="member">_accelRange</ref><sp/>=<sp/>range;</highlight></codeline>
<codeline lineno="157"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="158"><highlight class="normal">}</highlight></codeline>
<codeline lineno="159"><highlight class="normal"></highlight></codeline>
<codeline lineno="165" refid="classIMU_1a834f21762003f831e5e632cc7974ba75" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="classIMU_1a834f21762003f831e5e632cc7974ba75" kindref="member">IMU::setGyroRange</ref>(<ref refid="classIMU_1aeb363437539137b5c1eabd3641d242d1" kindref="member">GyroRange</ref><sp/>range)<sp/>{</highlight></codeline>
<codeline lineno="166"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">switch</highlight><highlight class="normal"><sp/>(range)<sp/>{</highlight></codeline>
<codeline lineno="167"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="classIMU_1aeb363437539137b5c1eabd3641d242d1a1726a676d603df0b5c73ff7f1fff00d3" kindref="member">GYRO_RANGE_250DPS</ref>:<sp/>{</highlight></codeline>
<codeline lineno="168"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>setting<sp/>the<sp/>gyro<sp/>range<sp/>to<sp/>250DPS</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="169"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classIMU_1a37694424e4502ffc69bbb6c540c1a400" kindref="member">writeRegister</ref>(<ref refid="classIMU_1a7d417d3c235bd4218a9cecb6c39b684d" kindref="member">GYRO_CONFIG</ref>,<sp/><ref refid="classIMU_1abaece728935c77934691fc678c971de4" kindref="member">GYRO_FS_SEL_250DPS</ref>)<sp/>&lt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="170"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="171"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="172"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classIMU_1a13aac4d32bd5e5bd5893a46adea43ba6" kindref="member">_gyroScale</ref><sp/>=</highlight></codeline>
<codeline lineno="173"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>250.0<sp/>/<sp/>32767.5<sp/>*<sp/>DEG_TO_RAD;<sp/></highlight><highlight class="comment">//<sp/>setting<sp/>the<sp/>gyro<sp/>scale<sp/>to<sp/>250DPS</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="174"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="175"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="176"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="classIMU_1aeb363437539137b5c1eabd3641d242d1a8a24172a6bd08e9402c83af2f12bed57" kindref="member">GYRO_RANGE_500DPS</ref>:<sp/>{</highlight></codeline>
<codeline lineno="177"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>setting<sp/>the<sp/>gyro<sp/>range<sp/>to<sp/>500DPS</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="178"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classIMU_1a37694424e4502ffc69bbb6c540c1a400" kindref="member">writeRegister</ref>(<ref refid="classIMU_1a7d417d3c235bd4218a9cecb6c39b684d" kindref="member">GYRO_CONFIG</ref>,<sp/><ref refid="classIMU_1a57d0058b144d11d64aa644ed1d3b313e" kindref="member">GYRO_FS_SEL_500DPS</ref>)<sp/>&lt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="179"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="180"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="181"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classIMU_1a13aac4d32bd5e5bd5893a46adea43ba6" kindref="member">_gyroScale</ref><sp/>=</highlight></codeline>
<codeline lineno="182"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>500.0<sp/>/<sp/>32767.5<sp/>*<sp/>DEG_TO_RAD;<sp/></highlight><highlight class="comment">//<sp/>setting<sp/>the<sp/>gyro<sp/>scale<sp/>to<sp/>500DPS</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="183"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="184"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="185"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="classIMU_1aeb363437539137b5c1eabd3641d242d1ac11c26d662eb1906caf70fb73d96e8bb" kindref="member">GYRO_RANGE_1000DPS</ref>:<sp/>{</highlight></codeline>
<codeline lineno="186"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>setting<sp/>the<sp/>gyro<sp/>range<sp/>to<sp/>1000DPS</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="187"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classIMU_1a37694424e4502ffc69bbb6c540c1a400" kindref="member">writeRegister</ref>(<ref refid="classIMU_1a7d417d3c235bd4218a9cecb6c39b684d" kindref="member">GYRO_CONFIG</ref>,<sp/><ref refid="classIMU_1ab8e2494d9e3021bf039323cf3440de1e" kindref="member">GYRO_FS_SEL_1000DPS</ref>)<sp/>&lt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="188"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="189"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="190"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classIMU_1a13aac4d32bd5e5bd5893a46adea43ba6" kindref="member">_gyroScale</ref><sp/>=</highlight></codeline>
<codeline lineno="191"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>1000.0<sp/>/<sp/>32767.5<sp/>*<sp/>DEG_TO_RAD;<sp/></highlight><highlight class="comment">//<sp/>setting<sp/>the<sp/>gyro<sp/>scale<sp/>to<sp/>1000DPS</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="192"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="193"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="194"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="classIMU_1aeb363437539137b5c1eabd3641d242d1aa9e87e7d062d3bb23e1c9b5a1e85af11" kindref="member">GYRO_RANGE_2000DPS</ref>:<sp/>{</highlight></codeline>
<codeline lineno="195"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>setting<sp/>the<sp/>gyro<sp/>range<sp/>to<sp/>2000DPS</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="196"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classIMU_1a37694424e4502ffc69bbb6c540c1a400" kindref="member">writeRegister</ref>(<ref refid="classIMU_1a7d417d3c235bd4218a9cecb6c39b684d" kindref="member">GYRO_CONFIG</ref>,<sp/><ref refid="classIMU_1a040f0183e93dc2c87f28f727c328a313" kindref="member">GYRO_FS_SEL_2000DPS</ref>)<sp/>&lt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="197"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="198"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="199"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classIMU_1a13aac4d32bd5e5bd5893a46adea43ba6" kindref="member">_gyroScale</ref><sp/>=</highlight></codeline>
<codeline lineno="200"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>2000.0<sp/>/<sp/>32767.5<sp/>*<sp/>DEG_TO_RAD;<sp/></highlight><highlight class="comment">//<sp/>setting<sp/>the<sp/>gyro<sp/>scale<sp/>to<sp/>2000DPS</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="201"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="202"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="203"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="204"><highlight class="normal"><sp/><sp/><ref refid="classIMU_1abc2f9849bd27b4d423b2140ebdc8701a" kindref="member">_gyroRange</ref><sp/>=<sp/>range;</highlight></codeline>
<codeline lineno="205"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="206"><highlight class="normal">}</highlight></codeline>
<codeline lineno="207"><highlight class="normal"></highlight></codeline>
<codeline lineno="213" refid="classIMU_1a928fa5e2db05bd402a3fa93bd3584527" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="classIMU_1a928fa5e2db05bd402a3fa93bd3584527" kindref="member">IMU::setDlpfBandwidth</ref>(<ref refid="classIMU_1a90c4f91f60185430b763f152ecb39521" kindref="member">DlpfBandwidth</ref><sp/>bandwidth)<sp/>{</highlight></codeline>
<codeline lineno="214"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">switch</highlight><highlight class="normal"><sp/>(bandwidth)<sp/>{</highlight></codeline>
<codeline lineno="215"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="classIMU_1a90c4f91f60185430b763f152ecb39521a461c657b4bc9c4f82936a9cb3b5ef54e" kindref="member">DLPF_BANDWIDTH_184HZ</ref>:<sp/>{</highlight></codeline>
<codeline lineno="216"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classIMU_1a37694424e4502ffc69bbb6c540c1a400" kindref="member">writeRegister</ref>(<ref refid="classIMU_1a0b4c0cfc28087ec72de6155da46de0d9" kindref="member">ACCEL_CONFIG2</ref>,<sp/><ref refid="classIMU_1a3f74d7d2c5a8c93151ae2bee4e0b4887" kindref="member">ACCEL_DLPF_184</ref>)<sp/>&lt;</highlight></codeline>
<codeline lineno="217"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>0)<sp/>{<sp/></highlight><highlight class="comment">//<sp/>setting<sp/>accel<sp/>bandwidth<sp/>to<sp/>184Hz</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="218"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="219"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="220"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classIMU_1a37694424e4502ffc69bbb6c540c1a400" kindref="member">writeRegister</ref>(<ref refid="classIMU_1a8b8013c6ee050d9a1c0c9aeb25b80cce" kindref="member">CONFIG</ref>,<sp/><ref refid="classIMU_1a2b7230a7c84242e46ffb1b801df342bd" kindref="member">GYRO_DLPF_184</ref>)<sp/>&lt;</highlight></codeline>
<codeline lineno="221"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>0)<sp/>{<sp/></highlight><highlight class="comment">//<sp/>setting<sp/>gyro<sp/>bandwidth<sp/>to<sp/>184Hz</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="222"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-2;</highlight></codeline>
<codeline lineno="223"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="224"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="225"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="226"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="classIMU_1a90c4f91f60185430b763f152ecb39521ac652b0fb4733da213152970ebc6ab53d" kindref="member">DLPF_BANDWIDTH_92HZ</ref>:<sp/>{</highlight></codeline>
<codeline lineno="227"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classIMU_1a37694424e4502ffc69bbb6c540c1a400" kindref="member">writeRegister</ref>(<ref refid="classIMU_1a0b4c0cfc28087ec72de6155da46de0d9" kindref="member">ACCEL_CONFIG2</ref>,<sp/><ref refid="classIMU_1ac87ed9eeb0d6fd20e987410155fee53f" kindref="member">ACCEL_DLPF_92</ref>)<sp/>&lt;</highlight></codeline>
<codeline lineno="228"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>0)<sp/>{<sp/></highlight><highlight class="comment">//<sp/>setting<sp/>accel<sp/>bandwidth<sp/>to<sp/>92Hz</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="229"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="230"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="231"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classIMU_1a37694424e4502ffc69bbb6c540c1a400" kindref="member">writeRegister</ref>(<ref refid="classIMU_1a8b8013c6ee050d9a1c0c9aeb25b80cce" kindref="member">CONFIG</ref>,<sp/><ref refid="classIMU_1a51863a08fe8094125b63498b591d0a54" kindref="member">GYRO_DLPF_92</ref>)<sp/>&lt;</highlight></codeline>
<codeline lineno="232"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>0)<sp/>{<sp/></highlight><highlight class="comment">//<sp/>setting<sp/>gyro<sp/>bandwidth<sp/>to<sp/>92Hz</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="233"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-2;</highlight></codeline>
<codeline lineno="234"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="235"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="236"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="237"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="classIMU_1a90c4f91f60185430b763f152ecb39521afcbbbba2e520cdd50dcb40da160137f0" kindref="member">DLPF_BANDWIDTH_41HZ</ref>:<sp/>{</highlight></codeline>
<codeline lineno="238"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classIMU_1a37694424e4502ffc69bbb6c540c1a400" kindref="member">writeRegister</ref>(<ref refid="classIMU_1a0b4c0cfc28087ec72de6155da46de0d9" kindref="member">ACCEL_CONFIG2</ref>,<sp/><ref refid="classIMU_1ae2df48f29311f232432a16284b9159ed" kindref="member">ACCEL_DLPF_41</ref>)<sp/>&lt;</highlight></codeline>
<codeline lineno="239"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>0)<sp/>{<sp/></highlight><highlight class="comment">//<sp/>setting<sp/>accel<sp/>bandwidth<sp/>to<sp/>41Hz</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="240"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="241"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="242"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classIMU_1a37694424e4502ffc69bbb6c540c1a400" kindref="member">writeRegister</ref>(<ref refid="classIMU_1a8b8013c6ee050d9a1c0c9aeb25b80cce" kindref="member">CONFIG</ref>,<sp/><ref refid="classIMU_1a178f00ee16f64288cc8d15f3fa4400f7" kindref="member">GYRO_DLPF_41</ref>)<sp/>&lt;</highlight></codeline>
<codeline lineno="243"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>0)<sp/>{<sp/></highlight><highlight class="comment">//<sp/>setting<sp/>gyro<sp/>bandwidth<sp/>to<sp/>41Hz</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="244"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-2;</highlight></codeline>
<codeline lineno="245"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="246"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="247"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="248"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="classIMU_1a90c4f91f60185430b763f152ecb39521a174ee7819d598dcbb0d29cf8d0f17e8f" kindref="member">DLPF_BANDWIDTH_20HZ</ref>:<sp/>{</highlight></codeline>
<codeline lineno="249"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classIMU_1a37694424e4502ffc69bbb6c540c1a400" kindref="member">writeRegister</ref>(<ref refid="classIMU_1a0b4c0cfc28087ec72de6155da46de0d9" kindref="member">ACCEL_CONFIG2</ref>,<sp/><ref refid="classIMU_1a524d9af6cbaa1df5f15db87b1157467c" kindref="member">ACCEL_DLPF_20</ref>)<sp/>&lt;</highlight></codeline>
<codeline lineno="250"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>0)<sp/>{<sp/></highlight><highlight class="comment">//<sp/>setting<sp/>accel<sp/>bandwidth<sp/>to<sp/>20Hz</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="251"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="252"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="253"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classIMU_1a37694424e4502ffc69bbb6c540c1a400" kindref="member">writeRegister</ref>(<ref refid="classIMU_1a8b8013c6ee050d9a1c0c9aeb25b80cce" kindref="member">CONFIG</ref>,<sp/><ref refid="classIMU_1a1f673a77bab71d2ae30959e7b9ddf5be" kindref="member">GYRO_DLPF_20</ref>)<sp/>&lt;</highlight></codeline>
<codeline lineno="254"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>0)<sp/>{<sp/></highlight><highlight class="comment">//<sp/>setting<sp/>gyro<sp/>bandwidth<sp/>to<sp/>20Hz</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="255"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-2;</highlight></codeline>
<codeline lineno="256"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="257"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="258"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="259"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="classIMU_1a90c4f91f60185430b763f152ecb39521a38fa7998dfeb640e0289bc7407c40285" kindref="member">DLPF_BANDWIDTH_10HZ</ref>:<sp/>{</highlight></codeline>
<codeline lineno="260"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classIMU_1a37694424e4502ffc69bbb6c540c1a400" kindref="member">writeRegister</ref>(<ref refid="classIMU_1a0b4c0cfc28087ec72de6155da46de0d9" kindref="member">ACCEL_CONFIG2</ref>,<sp/><ref refid="classIMU_1af0554e2b6db872868f21b6953a1e8585" kindref="member">ACCEL_DLPF_10</ref>)<sp/>&lt;</highlight></codeline>
<codeline lineno="261"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>0)<sp/>{<sp/></highlight><highlight class="comment">//<sp/>setting<sp/>accel<sp/>bandwidth<sp/>to<sp/>10Hz</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="262"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="263"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="264"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classIMU_1a37694424e4502ffc69bbb6c540c1a400" kindref="member">writeRegister</ref>(<ref refid="classIMU_1a8b8013c6ee050d9a1c0c9aeb25b80cce" kindref="member">CONFIG</ref>,<sp/><ref refid="classIMU_1a2675b7bb5b5d4a9d1333472248ff7d18" kindref="member">GYRO_DLPF_10</ref>)<sp/>&lt;</highlight></codeline>
<codeline lineno="265"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>0)<sp/>{<sp/></highlight><highlight class="comment">//<sp/>setting<sp/>gyro<sp/>bandwidth<sp/>to<sp/>10Hz</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="266"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-2;</highlight></codeline>
<codeline lineno="267"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="268"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="269"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="270"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="classIMU_1a90c4f91f60185430b763f152ecb39521a1d05af591f93fc300ae7ef2608c62f51" kindref="member">DLPF_BANDWIDTH_5HZ</ref>:<sp/>{</highlight></codeline>
<codeline lineno="271"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classIMU_1a37694424e4502ffc69bbb6c540c1a400" kindref="member">writeRegister</ref>(<ref refid="classIMU_1a0b4c0cfc28087ec72de6155da46de0d9" kindref="member">ACCEL_CONFIG2</ref>,<sp/><ref refid="classIMU_1aa1d7a036cec01526451187434785b0ef" kindref="member">ACCEL_DLPF_5</ref>)<sp/>&lt;</highlight></codeline>
<codeline lineno="272"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>0)<sp/>{<sp/></highlight><highlight class="comment">//<sp/>setting<sp/>accel<sp/>bandwidth<sp/>to<sp/>5Hz</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="273"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="274"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="275"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classIMU_1a37694424e4502ffc69bbb6c540c1a400" kindref="member">writeRegister</ref>(<ref refid="classIMU_1a8b8013c6ee050d9a1c0c9aeb25b80cce" kindref="member">CONFIG</ref>,<sp/><ref refid="classIMU_1a34c9619f6639e3ddda87b018eb94214e" kindref="member">GYRO_DLPF_5</ref>)<sp/>&lt;</highlight></codeline>
<codeline lineno="276"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>0)<sp/>{<sp/></highlight><highlight class="comment">//<sp/>setting<sp/>gyro<sp/>bandwidth<sp/>to<sp/>5Hz</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="277"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-2;</highlight></codeline>
<codeline lineno="278"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="279"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="280"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="281"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="282"><highlight class="normal"><sp/><sp/><ref refid="classIMU_1a1301777da9bc68eee7dc744a62b06ac3" kindref="member">_bandwidth</ref><sp/>=<sp/>bandwidth;</highlight></codeline>
<codeline lineno="283"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="284"><highlight class="normal">}</highlight></codeline>
<codeline lineno="290" refid="classIMU_1ac574728dbbc752155239a35c8bbd6e79" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="classIMU_1ac574728dbbc752155239a35c8bbd6e79" kindref="member">IMU::readSensor</ref>()<sp/>{</highlight></codeline>
<codeline lineno="291"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//_useSPIHS<sp/>=<sp/>true;<sp/>//<sp/>use<sp/>the<sp/>high<sp/>speed<sp/>SPI<sp/>for<sp/>data<sp/>readout</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="292"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>grab<sp/>the<sp/>data<sp/>from<sp/>the<sp/>MPU9250</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="293"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classIMU_1a87c200faa130ff4d2d3416b2d83f4f49" kindref="member">readRegisters</ref>(<ref refid="classIMU_1a5e6bc8a1984acb82321f9b48db9e8a79" kindref="member">ACCEL_OUT</ref>,<sp/>21,<sp/><ref refid="classIMU_1a36ebf3acc2b8f819d6f08650ddd98ca3" kindref="member">_buffer</ref>)<sp/>&lt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="294"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="295"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="296"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>combine<sp/>into<sp/>16<sp/>bit<sp/>values</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="297"><highlight class="normal"><sp/><sp/><ref refid="classIMU_1a412a6ac9638ce35bc63f1eedc7e152de" kindref="member">_axcounts</ref><sp/>=<sp/>(((int16_t)<ref refid="classIMU_1a36ebf3acc2b8f819d6f08650ddd98ca3" kindref="member">_buffer</ref>[0])<sp/>&lt;&lt;<sp/>8)<sp/>|<sp/><ref refid="classIMU_1a36ebf3acc2b8f819d6f08650ddd98ca3" kindref="member">_buffer</ref>[1];</highlight></codeline>
<codeline lineno="298"><highlight class="normal"><sp/><sp/><ref refid="classIMU_1a43dd65a4322fcfe0b802c0440849d7d5" kindref="member">_aycounts</ref><sp/>=<sp/>(((int16_t)<ref refid="classIMU_1a36ebf3acc2b8f819d6f08650ddd98ca3" kindref="member">_buffer</ref>[2])<sp/>&lt;&lt;<sp/>8)<sp/>|<sp/><ref refid="classIMU_1a36ebf3acc2b8f819d6f08650ddd98ca3" kindref="member">_buffer</ref>[3];</highlight></codeline>
<codeline lineno="299"><highlight class="normal"><sp/><sp/><ref refid="classIMU_1abfa89c440ef5607207713d1781eded13" kindref="member">_azcounts</ref><sp/>=<sp/>(((int16_t)<ref refid="classIMU_1a36ebf3acc2b8f819d6f08650ddd98ca3" kindref="member">_buffer</ref>[4])<sp/>&lt;&lt;<sp/>8)<sp/>|<sp/><ref refid="classIMU_1a36ebf3acc2b8f819d6f08650ddd98ca3" kindref="member">_buffer</ref>[5];</highlight></codeline>
<codeline lineno="300"><highlight class="normal"></highlight></codeline>
<codeline lineno="301"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>_tcounts<sp/>=<sp/>(((int16_t)_buffer[6])<sp/>&lt;&lt;<sp/>8)<sp/>|<sp/>_buffer[7];</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="302"><highlight class="normal"></highlight></codeline>
<codeline lineno="303"><highlight class="normal"><sp/><sp/><ref refid="classIMU_1ab27df333316fef090c6c66c850dcea6d" kindref="member">_gxcounts</ref><sp/>=<sp/>(((int16_t)<ref refid="classIMU_1a36ebf3acc2b8f819d6f08650ddd98ca3" kindref="member">_buffer</ref>[8])<sp/>&lt;&lt;<sp/>8)<sp/>|<sp/><ref refid="classIMU_1a36ebf3acc2b8f819d6f08650ddd98ca3" kindref="member">_buffer</ref>[9];</highlight></codeline>
<codeline lineno="304"><highlight class="normal"><sp/><sp/><ref refid="classIMU_1aa37b00f8fffb584f96166e6be835fc1c" kindref="member">_gycounts</ref><sp/>=<sp/>(((int16_t)<ref refid="classIMU_1a36ebf3acc2b8f819d6f08650ddd98ca3" kindref="member">_buffer</ref>[10])<sp/>&lt;&lt;<sp/>8)<sp/>|<sp/><ref refid="classIMU_1a36ebf3acc2b8f819d6f08650ddd98ca3" kindref="member">_buffer</ref>[11];</highlight></codeline>
<codeline lineno="305"><highlight class="normal"><sp/><sp/><ref refid="classIMU_1a16dd1d47613d444e8711704cb2225996" kindref="member">_gzcounts</ref><sp/>=<sp/>(((int16_t)<ref refid="classIMU_1a36ebf3acc2b8f819d6f08650ddd98ca3" kindref="member">_buffer</ref>[12])<sp/>&lt;&lt;<sp/>8)<sp/>|<sp/><ref refid="classIMU_1a36ebf3acc2b8f819d6f08650ddd98ca3" kindref="member">_buffer</ref>[13];</highlight></codeline>
<codeline lineno="306"><highlight class="normal"></highlight></codeline>
<codeline lineno="307"><highlight class="normal"><sp/><sp/><ref refid="classIMU_1afdba3ec94b88b71f4f3608ec7d5d7fc4" kindref="member">_hxcounts</ref><sp/>=<sp/>(((int16_t)<ref refid="classIMU_1a36ebf3acc2b8f819d6f08650ddd98ca3" kindref="member">_buffer</ref>[15])<sp/>&lt;&lt;<sp/>8)<sp/>|<sp/><ref refid="classIMU_1a36ebf3acc2b8f819d6f08650ddd98ca3" kindref="member">_buffer</ref>[14];</highlight></codeline>
<codeline lineno="308"><highlight class="normal"><sp/><sp/><ref refid="classIMU_1a49e29687dad5486c588df50035c8b5e0" kindref="member">_hycounts</ref><sp/>=<sp/>(((int16_t)<ref refid="classIMU_1a36ebf3acc2b8f819d6f08650ddd98ca3" kindref="member">_buffer</ref>[17])<sp/>&lt;&lt;<sp/>8)<sp/>|<sp/><ref refid="classIMU_1a36ebf3acc2b8f819d6f08650ddd98ca3" kindref="member">_buffer</ref>[16];</highlight></codeline>
<codeline lineno="309"><highlight class="normal"><sp/><sp/><ref refid="classIMU_1adc2810ff775c9d2474aeb1cdc6737979" kindref="member">_hzcounts</ref><sp/>=<sp/>(((int16_t)<ref refid="classIMU_1a36ebf3acc2b8f819d6f08650ddd98ca3" kindref="member">_buffer</ref>[19])<sp/>&lt;&lt;<sp/>8)<sp/>|<sp/><ref refid="classIMU_1a36ebf3acc2b8f819d6f08650ddd98ca3" kindref="member">_buffer</ref>[18];</highlight></codeline>
<codeline lineno="310"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*<sp/>corrige<sp/>a<sp/>direcao<sp/>do<sp/>eixo<sp/>z<sp/><sp/>para<sp/>-z<sp/>e<sp/>comuta<sp/>o<sp/>x<sp/>com<sp/>o<sp/>y</highlight></codeline>
<codeline lineno="311"><highlight class="comment">esse<sp/>procedimento<sp/>eh<sp/>fundamental<sp/>para<sp/>que<sp/>os<sp/>eixos<sp/>do<sp/>acelerometro<sp/>e<sp/>gyro<sp/>seja</highlight></codeline>
<codeline lineno="312"><highlight class="comment">compartilhados<sp/>como<sp/>o<sp/>magnetometro<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="313"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>*_acel<sp/>&lt;&lt;<sp/>(float)(_aycounts<sp/>-<sp/>_biasAccel[0]),</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="314"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/>(float)(_axcounts<sp/>-<sp/>_biasAccel[1]),<sp/>(float)(_azcounts<sp/>-<sp/>_biasAccel[2]);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="315"><highlight class="normal"><sp/><sp/>*<ref refid="classIMU_1a0efdfa77f452641689be4e9a4bae6a12" kindref="member">_acel</ref><sp/>&lt;&lt;<sp/>(float)(<ref refid="classIMU_1a43dd65a4322fcfe0b802c0440849d7d5" kindref="member">_aycounts</ref>),<sp/>(float)(<ref refid="classIMU_1a412a6ac9638ce35bc63f1eedc7e152de" kindref="member">_axcounts</ref>),<sp/>(float)(<ref refid="classIMU_1abfa89c440ef5607207713d1781eded13" kindref="member">_azcounts</ref>);</highlight></codeline>
<codeline lineno="316"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>*_acel<sp/>*=<sp/>_accelScale;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="317"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>*_acel<sp/>-=<sp/>_biasAccel;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="318"><highlight class="normal"><sp/><sp/>*<ref refid="classIMU_1a0efdfa77f452641689be4e9a4bae6a12" kindref="member">_acel</ref><sp/>=<sp/><ref refid="classIMU_1a377a386f44cf1d85d31b4f2a6b1a43d1" kindref="member">sFAccel</ref><sp/>*<sp/>(*_acel)<sp/>-<sp/><ref refid="classIMU_1a9a145f45e2e08cae0f363747c5603bd1" kindref="member">_biasAccel</ref>;</highlight></codeline>
<codeline lineno="319"><highlight class="normal"><sp/><sp/>*<ref refid="classIMU_1a72d1d4fe1027a9b0d6eed394e18ea97b" kindref="member">_gyro</ref><sp/>&lt;&lt;<sp/>-(float)<ref refid="classIMU_1aa37b00f8fffb584f96166e6be835fc1c" kindref="member">_gycounts</ref>,<sp/>-(</highlight><highlight class="keywordtype">float</highlight><highlight class="normal">)<ref refid="classIMU_1ab27df333316fef090c6c66c850dcea6d" kindref="member">_gxcounts</ref>,<sp/>-(float)<ref refid="classIMU_1a16dd1d47613d444e8711704cb2225996" kindref="member">_gzcounts</ref>;</highlight></codeline>
<codeline lineno="320"><highlight class="normal"><sp/><sp/>*<ref refid="classIMU_1a72d1d4fe1027a9b0d6eed394e18ea97b" kindref="member">_gyro</ref><sp/>*=<sp/><ref refid="classIMU_1a13aac4d32bd5e5bd5893a46adea43ba6" kindref="member">_gyroScale</ref>;</highlight></codeline>
<codeline lineno="321"><highlight class="normal"><sp/><sp/>*<ref refid="classIMU_1a72d1d4fe1027a9b0d6eed394e18ea97b" kindref="member">_gyro</ref><sp/>-=<sp/><ref refid="classIMU_1a9d22cd7cb7bb93f2e04aa713aed73532" kindref="member">_biasGyro</ref>;</highlight></codeline>
<codeline lineno="322"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>*_mag<sp/>&lt;&lt;<sp/>-(float)_hxcounts*_magScaleX,<sp/>-(float)_hycounts*_magScaleX,</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="323"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>(float)_hzcounts*_magScaleX;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="324"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>*_mag<sp/>=<sp/>_sM<sp/>*<sp/>(*_mag<sp/>-<sp/>_biasMag);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="325"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>para<sp/>analise<sp/>da<sp/>calibracao</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="326"><highlight class="normal"><sp/><sp/><ref refid="classIMU_1ae628afbcc858c70ea5d36a13d59998f2" kindref="member">magTemp</ref><sp/>&lt;&lt;<sp/>-(float)<ref refid="classIMU_1afdba3ec94b88b71f4f3608ec7d5d7fc4" kindref="member">_hxcounts</ref><sp/>*<sp/><ref refid="classIMU_1aca68ebe4db6de0261ad0c18ab93baa0c" kindref="member">_magScaleX</ref>,<sp/>-(</highlight><highlight class="keywordtype">float</highlight><highlight class="normal">)<ref refid="classIMU_1a49e29687dad5486c588df50035c8b5e0" kindref="member">_hycounts</ref><sp/>*<sp/><ref refid="classIMU_1aca68ebe4db6de0261ad0c18ab93baa0c" kindref="member">_magScaleX</ref>,</highlight></codeline>
<codeline lineno="327"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>-(float)<ref refid="classIMU_1adc2810ff775c9d2474aeb1cdc6737979" kindref="member">_hzcounts</ref><sp/>*<sp/><ref refid="classIMU_1aca68ebe4db6de0261ad0c18ab93baa0c" kindref="member">_magScaleX</ref>;</highlight></codeline>
<codeline lineno="328"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>*_mag<sp/>=<sp/>_sM<sp/>*<sp/>(magTemp<sp/>-<sp/>_biasMag);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="329"><highlight class="normal"><sp/><sp/>*<ref refid="classIMU_1a54e4834bdf8648b7ec11ca460b92facf" kindref="member">_mag</ref><sp/>=<sp/>(<ref refid="classIMU_1ae628afbcc858c70ea5d36a13d59998f2" kindref="member">magTemp</ref><sp/>-<sp/><ref refid="classIMU_1a3ba42ad7f598311689e5eccd75daa019" kindref="member">_biasMag</ref>);</highlight></codeline>
<codeline lineno="330"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*<sp/>@annotation<sp/>retirado<sp/>do<sp/>manual<sp/>de<sp/>registros<sp/>da<sp/>mpu9250<sp/>pag.33*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="331"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>TEMP_degC<sp/>=<sp/>((TEMP_OUT<sp/>–<sp/>RoomTemp_Offset)/Temp_Sensitivity)+<sp/>21degC</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="332"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>RoomTemp_Offset<sp/>=<sp/>21;<sp/>Temp_Sensitivity<sp/>=<sp/>333.87</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="333"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>_t<sp/>=<sp/>(float)_tcounts<sp/>/<sp/>333.87f<sp/>-<sp/>20.937101267f;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="334"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="335"><highlight class="normal">}</highlight></codeline>
<codeline lineno="343" refid="classIMU_1a5f096cb37d4b16851381bf09d6809403" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classIMU_1a5f096cb37d4b16851381bf09d6809403" kindref="member">IMU::calibraGyro</ref>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>N<sp/></highlight><highlight class="comment">/*=100*/</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="344"><highlight class="normal"><sp/><sp/>Eigen::Vector3f<sp/>_biasGyroTemp<sp/>=<sp/>Eigen::Vector3f::Zero();</highlight></codeline>
<codeline lineno="345"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Eigen::Vector3f<sp/>_biasAcelTemp<sp/>=<sp/>Eigen::Vector3f::Zero();</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="346"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>N;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="347"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classIMU_1ac574728dbbc752155239a35c8bbd6e79" kindref="member">readSensor</ref>();</highlight></codeline>
<codeline lineno="348"><highlight class="normal"><sp/><sp/><sp/><sp/>_biasGyroTemp<sp/>+=<sp/>*<ref refid="classIMU_1a72d1d4fe1027a9b0d6eed394e18ea97b" kindref="member">_gyro</ref>;</highlight></codeline>
<codeline lineno="349"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>_biasAcelTemp<sp/>+=<sp/>*_acel;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="350"><highlight class="normal"><sp/><sp/><sp/><sp/>delay(20);</highlight></codeline>
<codeline lineno="351"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="352"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>_biasGyro<sp/>/=<sp/>(float(N)<sp/>*<sp/>_gyroScale);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="353"><highlight class="normal"><sp/><sp/><ref refid="classIMU_1a9d22cd7cb7bb93f2e04aa713aed73532" kindref="member">_biasGyro</ref><sp/>=<sp/>_biasGyroTemp<sp/>/<sp/>float(N);</highlight></codeline>
<codeline lineno="354"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>_biasAcelTemp<sp/>/=<sp/>float(N);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="355"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>_biasAccel(0)<sp/>=<sp/>_biasAcelTemp(0);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="356"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>_biasAccel(1)<sp/>=<sp/>_biasAcelTemp(1);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="357"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>_biasAccel(2)<sp/>=<sp/>_biasAcelTemp(2)<sp/>-<sp/>gG;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="358"><highlight class="normal">}</highlight></codeline>
<codeline lineno="359"><highlight class="normal"></highlight></codeline>
<codeline lineno="360" refid="classIMU_1a914f8b4262fba70e6d8fd0e584fa7996" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="classIMU_1a914f8b4262fba70e6d8fd0e584fa7996" kindref="member">IMU::readAK8963Registers</ref>(uint8_t<sp/>subAddress,<sp/>uint8_t<sp/>count,<sp/>uint8_t<sp/>*dest)<sp/>{</highlight></codeline>
<codeline lineno="361"><highlight class="normal"><sp/><sp/><ref refid="classIMU_1a37694424e4502ffc69bbb6c540c1a400" kindref="member">writeRegister</ref>(<ref refid="classIMU_1a6ae19caaa47d77d07abf79af77e501e8" kindref="member">I2C_SLV0_ADDR</ref>,<sp/><ref refid="classIMU_1a4906bf7080228a00a2726fab0bc9deb1" kindref="member">AK8963_I2C_ADDR</ref><sp/>|<sp/><ref refid="classIMU_1a1ff3bc7d6cd3c4035ae2619248b9dd86" kindref="member">I2C_READ_FLAG</ref>);</highlight></codeline>
<codeline lineno="362"><highlight class="normal"><sp/><sp/><ref refid="classIMU_1a37694424e4502ffc69bbb6c540c1a400" kindref="member">writeRegister</ref>(<ref refid="classIMU_1a45b93a6a2bd367d73428482805ee65ce" kindref="member">I2C_SLV0_REG</ref>,<sp/>subAddress);</highlight></codeline>
<codeline lineno="363"><highlight class="normal"><sp/><sp/><ref refid="classIMU_1a37694424e4502ffc69bbb6c540c1a400" kindref="member">writeRegister</ref>(<ref refid="classIMU_1a3b6c38493eed68a58509e8be8b451ccf" kindref="member">I2C_SLV0_CTRL</ref>,<sp/><ref refid="classIMU_1a73733d4a18041bbc1f094a52be517118" kindref="member">I2C_SLV0_EN</ref><sp/>|<sp/>count);</highlight></codeline>
<codeline lineno="364"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>delay(1);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="365"><highlight class="normal"><sp/><sp/><ref refid="classIMU_1a279015ea1ea0a32b45a9a1a26b2d4fda" kindref="member">_status</ref><sp/>=<sp/><ref refid="classIMU_1a87c200faa130ff4d2d3416b2d83f4f49" kindref="member">readRegisters</ref>(<ref refid="classIMU_1af28bfb59bb04bc759038078a4db01993" kindref="member">EXT_SENS_DATA_00</ref>,<sp/>count,<sp/><ref refid="classIMU_1a36ebf3acc2b8f819d6f08650ddd98ca3" kindref="member">_buffer</ref>);</highlight></codeline>
<codeline lineno="366"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classIMU_1a279015ea1ea0a32b45a9a1a26b2d4fda" kindref="member">_status</ref>;</highlight></codeline>
<codeline lineno="367"><highlight class="normal">}</highlight></codeline>
<codeline lineno="368" refid="classIMU_1af3b90e0b20d4bd55091be99f7aa67737" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="classIMU_1af3b90e0b20d4bd55091be99f7aa67737" kindref="member">IMU::writeAK8963Register</ref>(uint8_t<sp/>subAddress,<sp/>uint8_t<sp/><ref refid="GPS_8h_1a27c939ba1a4f4d927aaa500781293ba7" kindref="member">data</ref>)<sp/>{</highlight></codeline>
<codeline lineno="369"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>set<sp/>slave<sp/>0<sp/>to<sp/>the<sp/>AK8963<sp/>and<sp/>set<sp/>for<sp/>write</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="370"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classIMU_1a37694424e4502ffc69bbb6c540c1a400" kindref="member">writeRegister</ref>(<ref refid="classIMU_1a6ae19caaa47d77d07abf79af77e501e8" kindref="member">I2C_SLV0_ADDR</ref>,<sp/><ref refid="classIMU_1a4906bf7080228a00a2726fab0bc9deb1" kindref="member">AK8963_I2C_ADDR</ref>)<sp/>&lt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="371"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="372"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="373"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>set<sp/>the<sp/>register<sp/>to<sp/>the<sp/>desired<sp/>AK8963<sp/>sub<sp/>address</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="374"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classIMU_1a37694424e4502ffc69bbb6c540c1a400" kindref="member">writeRegister</ref>(<ref refid="classIMU_1a45b93a6a2bd367d73428482805ee65ce" kindref="member">I2C_SLV0_REG</ref>,<sp/>subAddress)<sp/>&lt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="375"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-2;</highlight></codeline>
<codeline lineno="376"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="377"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>store<sp/>the<sp/>data<sp/>for<sp/>write</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="378"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classIMU_1a37694424e4502ffc69bbb6c540c1a400" kindref="member">writeRegister</ref>(<ref refid="classIMU_1ab6fc887f35142051d1b1fe3cba25aff0" kindref="member">I2C_SLV0_DO</ref>,<sp/><ref refid="GPS_8h_1a27c939ba1a4f4d927aaa500781293ba7" kindref="member">data</ref>)<sp/>&lt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="379"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-3;</highlight></codeline>
<codeline lineno="380"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="381"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>enable<sp/>I2C<sp/>and<sp/>send<sp/>1<sp/>byte</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="382"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classIMU_1a37694424e4502ffc69bbb6c540c1a400" kindref="member">writeRegister</ref>(<ref refid="classIMU_1a3b6c38493eed68a58509e8be8b451ccf" kindref="member">I2C_SLV0_CTRL</ref>,<sp/><ref refid="classIMU_1a73733d4a18041bbc1f094a52be517118" kindref="member">I2C_SLV0_EN</ref><sp/>|<sp/>(uint8_t)1)<sp/>&lt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="383"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-4;</highlight></codeline>
<codeline lineno="384"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="385"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>read<sp/>the<sp/>register<sp/>and<sp/>confirm</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="386"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classIMU_1a914f8b4262fba70e6d8fd0e584fa7996" kindref="member">readAK8963Registers</ref>(subAddress,<sp/>1,<sp/><ref refid="classIMU_1a36ebf3acc2b8f819d6f08650ddd98ca3" kindref="member">_buffer</ref>)<sp/>&lt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="387"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-5;</highlight></codeline>
<codeline lineno="388"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="389"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classIMU_1a36ebf3acc2b8f819d6f08650ddd98ca3" kindref="member">_buffer</ref>[0]<sp/>==<sp/><ref refid="GPS_8h_1a27c939ba1a4f4d927aaa500781293ba7" kindref="member">data</ref>)<sp/>{</highlight></codeline>
<codeline lineno="390"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="391"><highlight class="normal"><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="392"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-6;</highlight></codeline>
<codeline lineno="393"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="394"><highlight class="normal">}</highlight></codeline>
<codeline lineno="402" refid="classIMU_1a37694424e4502ffc69bbb6c540c1a400" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="classIMU_1a37694424e4502ffc69bbb6c540c1a400" kindref="member">IMU::writeRegister</ref>(uint8_t<sp/>subAddress,<sp/>uint8_t<sp/><ref refid="GPS_8h_1a27c939ba1a4f4d927aaa500781293ba7" kindref="member">data</ref>)<sp/>{</highlight></codeline>
<codeline lineno="403"><highlight class="normal"><sp/><sp/><ref refid="classIMU_1a18fe8e6be1b14c9e6c1b47d884dae375" kindref="member">_i2c</ref>-&gt;beginTransmission(<ref refid="classIMU_1ac538fc9a09f4d60b73fb477738b0d602" kindref="member">_address</ref>);<sp/></highlight><highlight class="comment">//<sp/>open<sp/>the<sp/>device</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="404"><highlight class="normal"><sp/><sp/><ref refid="classIMU_1a18fe8e6be1b14c9e6c1b47d884dae375" kindref="member">_i2c</ref>-&gt;write(subAddress);<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>write<sp/>the<sp/>register<sp/>address</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="405"><highlight class="normal"><sp/><sp/><ref refid="classIMU_1a18fe8e6be1b14c9e6c1b47d884dae375" kindref="member">_i2c</ref>-&gt;write(<ref refid="GPS_8h_1a27c939ba1a4f4d927aaa500781293ba7" kindref="member">data</ref>);<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>write<sp/>the<sp/>data</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="406"><highlight class="normal"><sp/><sp/><ref refid="classIMU_1a18fe8e6be1b14c9e6c1b47d884dae375" kindref="member">_i2c</ref>-&gt;endTransmission();</highlight></codeline>
<codeline lineno="407"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>delay(10);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="408"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*<sp/>read<sp/>back<sp/>the<sp/>register<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="409"><highlight class="normal"><sp/><sp/><ref refid="classIMU_1a87c200faa130ff4d2d3416b2d83f4f49" kindref="member">readRegisters</ref>(subAddress,<sp/>1,<sp/><ref refid="classIMU_1a36ebf3acc2b8f819d6f08650ddd98ca3" kindref="member">_buffer</ref>);</highlight></codeline>
<codeline lineno="410"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*<sp/>check<sp/>the<sp/>read<sp/>back<sp/>register<sp/>against<sp/>the<sp/>written<sp/>register<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="411"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classIMU_1a36ebf3acc2b8f819d6f08650ddd98ca3" kindref="member">_buffer</ref>[0]<sp/>==<sp/><ref refid="GPS_8h_1a27c939ba1a4f4d927aaa500781293ba7" kindref="member">data</ref>)<sp/>{</highlight></codeline>
<codeline lineno="412"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="413"><highlight class="normal"><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="414"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="415"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="416"><highlight class="normal">}</highlight></codeline>
<codeline lineno="424" refid="classIMU_1a87c200faa130ff4d2d3416b2d83f4f49" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="classIMU_1a87c200faa130ff4d2d3416b2d83f4f49" kindref="member">IMU::readRegisters</ref>(uint8_t<sp/>subAddress,<sp/>uint8_t<sp/>count,<sp/>uint8_t<sp/>*dest)<sp/>{</highlight></codeline>
<codeline lineno="425"><highlight class="normal"><sp/><sp/><ref refid="classIMU_1a18fe8e6be1b14c9e6c1b47d884dae375" kindref="member">_i2c</ref>-&gt;beginTransmission(<ref refid="classIMU_1ac538fc9a09f4d60b73fb477738b0d602" kindref="member">_address</ref>);</highlight></codeline>
<codeline lineno="426"><highlight class="normal"><sp/><sp/><ref refid="classIMU_1a18fe8e6be1b14c9e6c1b47d884dae375" kindref="member">_i2c</ref>-&gt;write(subAddress);</highlight></codeline>
<codeline lineno="427"><highlight class="normal"><sp/><sp/><ref refid="classIMU_1a18fe8e6be1b14c9e6c1b47d884dae375" kindref="member">_i2c</ref>-&gt;endTransmission(</highlight><highlight class="keyword">false</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="428"><highlight class="normal"><sp/><sp/><ref refid="classIMU_1a6911d1a81b2cbbefde2357df0c77428d" kindref="member">_numBytes</ref><sp/>=<sp/><ref refid="classIMU_1a18fe8e6be1b14c9e6c1b47d884dae375" kindref="member">_i2c</ref>-&gt;requestFrom(<ref refid="classIMU_1ac538fc9a09f4d60b73fb477738b0d602" kindref="member">_address</ref>,<sp/>count);</highlight></codeline>
<codeline lineno="429"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classIMU_1a6911d1a81b2cbbefde2357df0c77428d" kindref="member">_numBytes</ref><sp/>==<sp/>count)<sp/>{</highlight></codeline>
<codeline lineno="430"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(uint8_t<sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>count;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="431"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>dest[i]<sp/>=<sp/><ref refid="classIMU_1a18fe8e6be1b14c9e6c1b47d884dae375" kindref="member">_i2c</ref>-&gt;read();</highlight></codeline>
<codeline lineno="432"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="433"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="434"><highlight class="normal"><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="435"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="436"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="437"><highlight class="normal">}</highlight></codeline>
<codeline lineno="442" refid="classIMU_1a0481a2f76feaf06534e9473118d55ee3" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="classIMU_1a0481a2f76feaf06534e9473118d55ee3" kindref="member">IMU::whoAmI</ref>()<sp/>{</highlight></codeline>
<codeline lineno="443"><highlight class="normal"><sp/><sp/><ref refid="classIMU_1a87c200faa130ff4d2d3416b2d83f4f49" kindref="member">readRegisters</ref>(<ref refid="classIMU_1ad608d0b182a0da8574b85194f5707d14" kindref="member">WHO_AM_I</ref>,<sp/>1,<sp/><ref refid="classIMU_1a36ebf3acc2b8f819d6f08650ddd98ca3" kindref="member">_buffer</ref>);</highlight></codeline>
<codeline lineno="444"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classIMU_1a36ebf3acc2b8f819d6f08650ddd98ca3" kindref="member">_buffer</ref>[0];</highlight></codeline>
<codeline lineno="445"><highlight class="normal">}</highlight></codeline>
<codeline lineno="449" refid="classIMU_1acd2af48f4eb0a0321080332016e3c1f7" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="classIMU_1acd2af48f4eb0a0321080332016e3c1f7" kindref="member">IMU::whoAmIAK8963</ref>()<sp/>{</highlight></codeline>
<codeline lineno="450"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classIMU_1a914f8b4262fba70e6d8fd0e584fa7996" kindref="member">readAK8963Registers</ref>(<ref refid="classIMU_1afbf16a57d58c858beda5ccf36ee4b81f" kindref="member">AK8963_WHO_AM_I</ref>,<sp/>1,<sp/><ref refid="classIMU_1a36ebf3acc2b8f819d6f08650ddd98ca3" kindref="member">_buffer</ref>)<sp/>&lt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="451"><highlight class="normal"><sp/><sp/><sp/><sp/>Serial.println(</highlight><highlight class="stringliteral">&quot;Nao<sp/>sei<sp/>quem<sp/>sou&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="452"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="453"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="454"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Serial.println(&quot;Endereco<sp/>do<sp/>magnetometro&quot;);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="455"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Serial.print(_buffer[0]);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="456"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classIMU_1a36ebf3acc2b8f819d6f08650ddd98ca3" kindref="member">_buffer</ref>[0];</highlight></codeline>
<codeline lineno="457"><highlight class="normal">}</highlight></codeline>
<codeline lineno="458" refid="classIMU_1a3546779010d9128859f465195eff77f5" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="classIMU_1a3546779010d9128859f465195eff77f5" kindref="member">IMU::calibracaoMagnetometro</ref>(</highlight><highlight class="keywordtype">float</highlight><highlight class="normal"><sp/>moduloCampo)<sp/>{</highlight></codeline>
<codeline lineno="459"><highlight class="normal"></highlight></codeline>
<codeline lineno="460"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>numero<sp/>de<sp/>medidas<sp/>para<sp/>armazenar<sp/>dados</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="461"><highlight class="normal"><sp/><sp/><ref refid="classMETODOSCALIBRACAO" kindref="compound">METODOSCALIBRACAO</ref><sp/>CAL;<sp/></highlight><highlight class="comment">//<sp/>instancia<sp/>funcoes<sp/>de<sp/>calibracao</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="462"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>N<sp/>=<sp/>500;</highlight></codeline>
<codeline lineno="463"><highlight class="normal"><sp/><sp/>MatrixXf<sp/>medidas<sp/>=<sp/>MatrixXf::Zero(3,<sp/>N);</highlight></codeline>
<codeline lineno="464"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>coleta<sp/>N<sp/>medidas</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="465"><highlight class="normal"><sp/><sp/>VectorXf<sp/>temp(17);</highlight></codeline>
<codeline lineno="466"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>N;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="467"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classIMU_1ac574728dbbc752155239a35c8bbd6e79" kindref="member">readSensor</ref>();</highlight></codeline>
<codeline lineno="468"><highlight class="normal"><sp/><sp/><sp/><sp/>medidas.col(i)<sp/>=<sp/><ref refid="classIMU_1ae628afbcc858c70ea5d36a13d59998f2" kindref="member">magTemp</ref>;</highlight></codeline>
<codeline lineno="469"><highlight class="normal"><sp/><sp/><sp/><sp/>delay(20);</highlight></codeline>
<codeline lineno="470"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="471"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>CAL.<ref refid="classMETODOSCALIBRACAO_1af0478ed112a1139bafefe7833568e641" kindref="member">calibracaoGeometrica</ref>(medidas,<sp/><ref refid="classIMU_1af5d90aa5410529450fd31da2e1b1f296" kindref="member">_sM</ref>,<sp/><ref refid="classIMU_1a3ba42ad7f598311689e5eccd75daa019" kindref="member">_biasMag</ref>,<sp/>moduloCampo);</highlight></codeline>
<codeline lineno="472"><highlight class="normal">}</highlight></codeline>
    </programlisting>
    <location file="lib/IMU/IMU.cpp"/>
  </compounddef>
</doxygen>
